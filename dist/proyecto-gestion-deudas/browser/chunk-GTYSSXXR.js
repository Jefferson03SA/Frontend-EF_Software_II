import{b as F,d as D,i as U}from"./chunk-VSZ4XMOF.js";import{b as I,d as x,f as T,g as z,j as N,k as q,l as A,m as G,q as B,s as L,u as H}from"./chunk-BY2RSABG.js";import"./chunk-ZPAV5QTQ.js";import{Ac as R,Bb as l,Bc as j,Jb as d,Kb as y,Qb as E,Rb as P,Sa as m,Sb as k,Ta as _,ga as S,jb as C,lb as g,oa as u,pa as h,qa as v,ra as b,rb as i,sb as o,tb as p,ub as w,uc as V,vb as M,wb as O,zb as f}from"./chunk-QGCOHCHE.js";function J(r,s){if(r&1){let a=O();w(0),i(1,"div",4)(2,"div",5),f("click",function(){u(a);let e=l();return h(e.onSeleccionarOpcion("ocr"))}),i(3,"div",6),v(),i(4,"svg",7),p(5,"rect",8)(6,"circle",9)(7,"path",10),o()(),b(),i(8,"div",11),d(9,"OCR"),o()(),i(10,"div",12),f("click",function(){u(a);let e=l();return h(e.onSeleccionarOpcion("manual"))}),i(11,"div",6),v(),i(12,"svg",13),p(13,"path",14)(14,"path",15),o()(),b(),i(15,"div",11),d(16,"MANUAL"),o()()(),M()}}function W(r,s){if(r&1&&(i(0,"div",28),d(1),o()),r&2){let a=l(2);m(),y(a.errorMsg)}}function Y(r,s){if(r&1){let a=O();w(0),i(1,"form",16),f("ngSubmit",function(){u(a);let e=l();return h(e.onSubmit())}),C(2,W,2,1,"div",17),i(3,"div",18)(4,"label",19),d(5,"N\xFAmero de documento"),o(),p(6,"input",20),o(),i(7,"div",18)(8,"label",21),d(9,"Empresa del servicio"),o(),p(10,"input",22),o(),i(11,"div",18)(12,"label",23),d(13,"Monto"),o(),p(14,"input",24),o(),i(15,"div",18)(16,"label",25),d(17,"Fecha de vencimiento"),o(),p(18,"input",26),o(),i(19,"button",27),d(20,"Guardar"),o()(),M()}if(r&2){let a=l();m(),g("formGroup",a.deudaForm),m(),g("ngIf",a.errorMsg),m(17),g("disabled",!a.deudaForm.valid)}}function K(r,s){if(r&1&&(i(0,"div",43)(1,"h3"),d(2,"Resultado OCR"),o(),i(3,"pre"),d(4),P(5,"json"),o()()),r&2){let a=l(2);m(4),y(k(5,1,a.ocrResultado))}}function Q(r,s){if(r&1){let a=O();w(0),i(1,"div",29)(2,"div",30),p(3,"video",31),i(4,"button",32),f("click",function(){u(a);let e=l();return h(e.tomarFoto())}),d(5,"Tomar foto"),o()(),i(6,"div",33),d(7,"o"),o(),i(8,"label",34)(9,"input",35),f("change",function(e){u(a);let c=l();return h(c.onFileSelected(e))}),o(),i(10,"div",36),v(),i(11,"svg",37),p(12,"rect",38)(13,"circle",39)(14,"path",40),o()(),b(),i(15,"div",41),d(16,"Cargar imagen"),o()(),C(17,K,6,3,"div",42),o(),M()}if(r&2){let a=l();m(17),g("ngIf",a.ocrResultado)}}var oe=(()=>{let s=class s{constructor(t,e,c,n){this.fb=t,this.serviciosService=e,this.router=c,this.route=n,this.errorMsg=null,this.opcionSeleccionada=null,this.ocrResultado=null,this.videoElement=null,this.canvasElement=null,this.stream=null,this.deudaForm=this.fb.group({numeroDocumento:["",x.required],empresa:["",x.required],monto:["",[x.required,x.min(0)]],fechaVencimiento:["",x.required]})}ngOnInit(){this.route.queryParams.subscribe(t=>{t.id&&this.serviciosService.getDeudaById(t.id).subscribe({next:e=>this.deudaForm.patchValue(e)})})}onSubmit(){if(this.errorMsg=null,this.deudaForm.valid){let t=this.route.snapshot.queryParamMap.get("id");if(t){let e=this.deudaForm.value,c={};for(let n of Object.keys(e))e[n]!==null&&e[n]!==void 0&&e[n]!==""&&(c[n]=e[n]);delete c.id,this.serviciosService.actualizarDeudaPatch(Number(t),c).subscribe({next:()=>this.router.navigate(["/dashboard"]),error:n=>{this.errorMsg=n?.error?.message||"Error al actualizar deuda",console.error("Error al actualizar deuda (PATCH)",n)}})}else this.serviciosService.crearDeuda(this.deudaForm.value).subscribe({next:()=>this.router.navigate(["/dashboard"]),error:e=>{this.errorMsg=e?.error?.message||"Error al registrar deuda",console.error("Error al registrar deuda",e)}})}}onSeleccionarOpcion(t){this.opcionSeleccionada=t,console.log("Opci\xF3n seleccionada:",t),t==="ocr"?setTimeout(()=>this.iniciarCamara(),100):this.detenerCamara()}iniciarCamara(){this.videoElement=document.querySelector("#ocrVideo"),navigator.mediaDevices&&this.videoElement&&navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{this.stream=t,this.videoElement.srcObject=t,this.videoElement.play()}).catch(t=>{console.error("No se pudo acceder a la c\xE1mara",t)})}detenerCamara(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoElement&&(this.videoElement.srcObject=null)}tomarFoto(){if(this.videoElement=document.querySelector("#ocrVideo"),this.canvasElement=document.createElement("canvas"),this.videoElement&&this.canvasElement){this.canvasElement.width=this.videoElement.videoWidth,this.canvasElement.height=this.videoElement.videoHeight;let t=this.canvasElement.getContext("2d");t&&(t.drawImage(this.videoElement,0,0,this.canvasElement.width,this.canvasElement.height),this.canvasElement.toBlob(e=>{if(e){let c=new File([e],"captura.jpg",{type:"image/jpeg"});this.serviciosService.procesarImagenOCR(c).subscribe({next:n=>{this.ocrResultado=n,n&&(this.deudaForm.patchValue({numeroDocumento:n.numeroDocumento||"",empresa:n.empresa||"",monto:n.monto||"",fechaVencimiento:n.fechaVencimiento||""}),this.opcionSeleccionada="manual")},error:n=>{this.ocrResultado=null,console.error("Error OCR:",n)}})}},"image/jpeg"))}}onFileSelected(t){let e=t.target;if(e.files&&e.files.length>0){let c=e.files[0];this.serviciosService.procesarImagenOCR(c).subscribe({next:n=>{this.ocrResultado=n,n&&(this.deudaForm.patchValue({numeroDocumento:n.numeroDocumento||"",empresa:n.empresa||"",monto:n.monto||"",fechaVencimiento:n.fechaVencimiento||""}),this.opcionSeleccionada="manual")},error:n=>{this.ocrResultado=null,console.error("Error OCR:",n)}})}}ngOnDestroy(){this.detenerCamara()}};s.\u0275fac=function(e){return new(e||s)(_(L),_(U),_(D),_(F))},s.\u0275cmp=S({type:s,selectors:[["app-registrar"]],standalone:!0,features:[E],decls:6,vars:3,consts:[[1,"registrar-outer-center"],[1,"registrar-outer-container"],[1,"registrar-container","fade-in"],[4,"ngIf"],[1,"opciones-registro"],[1,"opcion-registro","opcion-ocr",3,"click"],[1,"icono-opcion"],["width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","#0A2618","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","3","y","5","width","18","height","14","rx","3"],["cx","12","cy","12","r","3.5"],["d","M8 5V3M16 5V3"],[1,"texto-opcion"],[1,"opcion-registro","opcion-manual",3,"click"],["width","48","height","48","viewBox","0 0 24 24","fill","none","stroke","#1976d2","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","M12 20h9"],["d","M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19.5 3 21l1.5-4L16.5 3.5z"],[1,"registrar-form",3,"ngSubmit","formGroup"],["class","error-message",4,"ngIf"],[1,"form-group"],["for","numeroDocumento"],["id","numeroDocumento","formControlName","numeroDocumento","type","text","required",""],["for","empresa"],["id","empresa","formControlName","empresa","type","text","required",""],["for","monto"],["id","monto","formControlName","monto","type","number","required",""],["for","fechaVencimiento"],["id","fechaVencimiento","formControlName","fechaVencimiento","type","date","required",""],["type","submit",1,"btn-primary",3,"disabled"],[1,"error-message"],[1,"ocr-container"],[1,"ocr-camera-box"],["id","ocrVideo","autoplay","","playsinline","",2,"width","100%","height","100%","object-fit","cover","border-radius","18px"],["type","button",1,"btn-primary","ocr-tomar-foto",3,"click"],[1,"ocr-or"],[1,"ocr-upload-label"],["type","file","accept","image/*","hidden","",3,"change"],[1,"ocr-upload-icon"],["width","64","height","64","viewBox","0 0 24 24","fill","none","stroke","#1976d2","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["x","3","y","3","width","18","height","18","rx","4"],["cx","8.5","cy","8.5","r","1.5"],["d","M21 15l-5-5L5 21"],[1,"ocr-upload-text"],["class","ocr-resultado",4,"ngIf"],[1,"ocr-resultado"]],template:function(e,c){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),C(3,J,17,0,"ng-container",3)(4,Y,21,3,"ng-container",3)(5,Q,18,1,"ng-container",3),o()()()),e&2&&(m(3),g("ngIf",!c.opcionSeleccionada),m(),g("ngIf",c.opcionSeleccionada==="manual"),m(),g("ngIf",c.opcionSeleccionada==="ocr"))},dependencies:[j,V,R,H,N,I,q,T,z,B,A,G],styles:[".registrar-outer-center[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100vh;display:flex;justify-content:center;align-items:center;background:#def2de}.registrar-outer-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.registrar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;background:transparent;width:100%}.registrar-form[_ngcontent-%COMP%]{width:100%;max-width:400px;background:#fff;border-radius:18px;box-shadow:0 4px 24px #0001;padding:2rem 1.5rem;margin:0 auto;display:flex;flex-direction:column;gap:1.2rem}.form-group[_ngcontent-%COMP%]{margin-bottom:20px;text-align:left}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%], input[type=date][_ngcontent-%COMP%]{width:100%;background:#e0ebde;border:none;border-radius:12px;padding:10px 12px;font-size:1rem;margin-top:6px;box-sizing:border-box}input[_ngcontent-%COMP%]:focus{outline:2px solid #b2d8b2}label[_ngcontent-%COMP%]{font-weight:500;color:#28342e;margin-bottom:4px}button.btn-primary[_ngcontent-%COMP%]{background:#2e4632;color:#fff;border:none;border-radius:20px;padding:10px 0;width:100%;font-size:1.1rem;margin-top:20px;transition:background .2s}button.btn-primary[_ngcontent-%COMP%]:disabled{background:#b2d8b2;color:#fff}.error-message[_ngcontent-%COMP%]{background:#ffeded;color:#c62828;border-radius:12px;padding:12px 16px;margin-bottom:18px;font-weight:500;text-align:center;border:1px solid #ffcdd2;box-shadow:0 2px 8px #c6282808}.opciones-registro[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:3rem;margin-top:2rem}.opcion-registro[_ngcontent-%COMP%]{background:#fff;border-radius:24px;box-shadow:0 4px 24px #0001;padding:3.5rem 3.5rem 2.5rem;min-width:320px;min-height:320px;max-width:340px;max-height:340px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:box-shadow .2s,transform .2s,background .2s;border:3px solid #DEF2DE}.opcion-registro[_ngcontent-%COMP%]:hover{box-shadow:0 8px 32px #0a261833;background:#def2de;transform:translateY(-6px) scale(1.03)}.icono-opcion[_ngcontent-%COMP%]{margin-bottom:2.2rem;display:flex;align-items:center;justify-content:center}.icono-opcion[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:120px;height:120px}.texto-opcion[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#0a2618;letter-spacing:2px;text-align:center}.opcion-ocr[_ngcontent-%COMP%]   .icono-opcion[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#0a2618}.opcion-manual[_ngcontent-%COMP%]   .icono-opcion[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{stroke:#1976d2}.ocr-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2.5rem;margin-top:2.5rem}.ocr-camera-box[_ngcontent-%COMP%]{width:380px;height:280px;background:#def2de;border:3px dashed #1976d2;border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;color:#0a2618;margin-bottom:.5rem;position:relative}.ocr-tomar-foto[_ngcontent-%COMP%]{position:absolute;bottom:12px;left:50%;transform:translate(-50%);z-index:2;background:#1976d2;color:#fff;border:none;border-radius:12px;padding:.7rem 2.2rem;font-size:1.1rem;font-weight:600;box-shadow:0 2px 8px #1976d233;cursor:pointer;transition:background .2s}.ocr-tomar-foto[_ngcontent-%COMP%]:hover{background:#1251a3}.ocr-camera-placeholder[_ngcontent-%COMP%]{opacity:.6;font-weight:600}.ocr-or[_ngcontent-%COMP%]{font-size:1.5rem;color:#28342e;margin:1.2rem 0 .5rem;font-weight:500}.ocr-upload-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;cursor:pointer;gap:.5rem}.ocr-upload-icon[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 4px 24px #0001;padding:1.2rem;display:flex;align-items:center;justify-content:center;transition:box-shadow .2s,background .2s}.ocr-upload-label[_ngcontent-%COMP%]:hover   .ocr-upload-icon[_ngcontent-%COMP%]{background:#def2de;box-shadow:0 8px 32px #1976d233}.ocr-upload-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:64px;height:64px}.ocr-upload-text[_ngcontent-%COMP%]{font-size:1.3rem;color:#1976d2;font-weight:600;margin-top:.2rem}.ocr-resultado[_ngcontent-%COMP%]{margin-top:2rem;background:#fff;border-radius:18px;box-shadow:0 4px 24px #0001;padding:1.5rem 2rem;max-width:480px;width:100%;color:#0a2618;font-size:1.1rem;word-break:break-word}.ocr-resultado[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#1976d2;font-size:1.3rem;margin-bottom:.7rem;font-weight:700}.ocr-resultado[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{background:#def2de;border-radius:8px;padding:1rem;font-size:1rem;color:#28342e;overflow-x:auto}@media (max-width: 600px){.registrar-form[_ngcontent-%COMP%]{max-width:95vw;padding:1.2rem .5rem}}@media (max-width: 900px){.opciones-registro[_ngcontent-%COMP%]{flex-direction:column;gap:2rem}.opcion-registro[_ngcontent-%COMP%]{min-width:90vw;max-width:95vw;min-height:220px;max-height:260px;padding:2rem 1rem 1.5rem}.icono-opcion[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:70px;height:70px}.texto-opcion[_ngcontent-%COMP%]{font-size:2rem}.ocr-camera-box[_ngcontent-%COMP%]{width:90vw;height:180px}.ocr-upload-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:40px;height:40px}}"]});let r=s;return r})();export{oe as RegistrarComponent};
